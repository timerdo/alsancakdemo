<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>3D Alsancak Stadı Destek Projesi</title>
    <style>
        body { margin: 0; background-color: #050505; color: white; font-family: sans-serif; overflow: hidden; }
        #ui {
            position: absolute; top: 20px; left: 20px; z-index: 100;
            background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px; border: 1px solid #d71920;
        }
        .stats { font-size: 24px; color: #d71920; font-weight: bold; }
        .controls { margin-top: 10px; }
        button { background: #d71920; color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 5px; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui">
    <div style="font-size: 12px; letter-spacing: 2px;">CANLI DESTEK DURUMU</div>
    <div class="stats">Kırmızı Koltuk: <span id="count">0</span></div>
    <div class="controls">
        <button onclick="simulateSMS()">+10 Koltuk Kırmızı Yap</button>
    </div>
    <p style="font-size: 11px; opacity: 0.7;">Farenizle stadı döndürebilir ve yakınlaşabilirsiniz.</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
    let scene, camera, renderer, controls;
    let stadiumModel; // Yüklenecek 3D stadyum modeli
    let seats = []; // Koltukları bu array'de tutacağız
    let currentSms = 0;
    const TOTAL_STADIUM_SEATS = 15000; // Varsayılan Alsancak kapasitesi

    function init() {
        // Sahne Kurulumu
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 50, 150); // Stadın genelini görecek bir başlangıç pozisyonu

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Işıklandırma
        scene.add(new THREE.AmbientLight(0x404040, 2)); // Genel ortam ışığı
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(0, 100, 50);
        scene.add(directionalLight);

        // Orbit Controls (Fare ile döndürme ve zoom)
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // Daha akıcı döndürme
        controls.dampingFactor = 0.05;
        controls.maxDistance = 300; // Maksimum uzaklaşma
        controls.minDistance = 50;  // Minimum yakınlaşma

        // GLTF Model Yükleyici
        const loader = new THREE.GLTFLoader();
        loader.load(
            'alsancak_stadium.gltf', // Buraya Alsancak Stadı'nın 3D model dosyasını koyacaksın
            function (gltf) {
                stadiumModel = gltf.scene;
                scene.add(stadiumModel);

                // **Önemli: Koltukları model içinden bulma ve listeye ekleme**
                // Bu kısım, 3D modelin içindeki koltukların nasıl adlandırıldığına bağlıdır.
                // Genellikle 'Seat_001', 'Seat_002' gibi isimlerle gelirler.
                stadiumModel.traverse((child) => {
                    if (child.isMesh && child.name.startsWith('Seat')) { // Koltuk mesh'lerini isme göre filtrele
                        seats.push(child);
                    }
                });
                console.log(`Model yüklendi. Bulunan koltuk sayısı: ${seats.length}`);
                if(seats.length === 0) {
                    console.warn("Model içinde 'Seat' ile başlayan koltuk objesi bulunamadı. Lütfen 3D modeldeki koltuk isimlendirmelerini kontrol edin.");
                }
                updateSeats(); // İlk yüklemede mevcut SMS sayısına göre koltukları renklendir
            },
            undefined, // Yükleme ilerleme fonksiyonu (isteğe bağlı)
            function (error) {
                console.error('3D model yüklenirken bir hata oluştu:', error);
                alert('Stadyum modeli yüklenemedi. alsancak_stadium.gltf dosyasını kontrol edin.');
            }
        );

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update(); // OrbitControls'u güncelle
        renderer.render(scene, camera);
    }

    // SMS simülasyonu (gerçek SMS entegrasyonunda bu fonksiyon API'den çağrılacak)
    function simulateSMS() {
        currentSms = Math.min(currentSms + 10, TOTAL_STADIUM_SEATS); // Koltuk kapasitesini aşma
        document.getElementById('count').innerText = currentSms;
        updateSeats();
    }

    // Koltukları renklendirme fonksiyonu
    function updateSeats() {
        // Beyaz ve Kırmızı koltuk materyalleri
        const whiteMaterial = new THREE.MeshLambertMaterial({ color: 0xcccccc }); // Açık gri
        const redMaterial = new THREE.MeshLambertMaterial({ color: 0xd71920, emissive: 0x500000 }); // Kırmızı, hafif parlak

        for (let i = 0; i < seats.length; i++) {
            if (i < currentSms) {
                seats[i].material = redMaterial;
            } else {
                seats[i].material = whiteMaterial;
            }
        }
    }

    // Pencere boyutu değiştiğinde sahneyi ayarla
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init(); // Sahneyi başlat
</script>
</body>
</html>
